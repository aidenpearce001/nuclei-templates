id: advanced-cors-misconfig

info:
  name: Advanced CORS misconfiguration
  author: bolli95
  severity: medium
  description: Inspired by Basic CORS misconfiguration template by nadino. I added some more advanced misconfiguration checks. 


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://evil{{BaseURL}}"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://evil{{BaseURL}}"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://wwwa{{Hostname}}"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://wwwa{{Hostname}}"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}!.evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}!.evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}\".evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}\".evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}$.evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}$.evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}%0b.evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}%0b.evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}&.evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}&.evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}'.evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}'.evil.com"
        part: header

requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}).evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}).evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}(.evil.com "
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}(.evil.com "
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}*.evil.com "
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}*.evil.com "
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}=.evil.com "
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}=.evil.com "
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}};.evil.com "
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}};.evil.com "
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.{{BaseURL}}"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.{{BaseURL}}"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://{{BaseURL}}evil.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://{{BaseURL}}evil.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "null"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: null"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://jsbin.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://jsbin.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://jsfiddle.net"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://jsfiddle.net"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://repl.it"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://repl.it"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "http://www.webdevout.net"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: http://www.webdevout.net"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://codepen.io"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://codepen.io"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.us-east-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.us-east-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.us-east-2.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.us-east-2.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.us-west-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.us-west-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.us-west-2.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.us-west-2.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.af-south-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.af-south-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-east-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-east-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-east-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-east-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-northeast-3.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-northeast-3.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-northeast-2.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-northeast-2.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-northeast-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-northeast-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ap-southeast-2.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ap-southeast-2.amazonaws.com"
        part: header

requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.ca-central-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.ca-central-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.cn-north-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.cn-north-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.cn-northwest-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.cn-northwest-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-central-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-central-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-west-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-west-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-west-2.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-west-2.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-south-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-south-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-west-3.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-west-3.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.eu-north-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.eu-north-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.me-south-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.me-south-1.amazonaws.com"
        part: header


requests:
  - method: GET
    path:
      - "{{BaseURL}}"
    headers:
      Origin: "https://test.s3.sa-east-1.amazonaws.com"
    matchers:
      - type: word
        words:
          - "Access-Control-Allow-Origin: https://test.s3.sa-east-1.amazonaws.com"
        part: header


